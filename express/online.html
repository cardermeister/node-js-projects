<!-- Styles -->
<style>
    body { background-color: #30303d; color: #fff; }
    #chartdiv {
        width	: 100%;
        height	: 60%;
    }																	
</style>
    
    <!-- Resources -->
<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
<script src="https://www.amcharts.com/lib/3/serial.js"></script>
<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
<link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
<script src="https://www.amcharts.com/lib/3/themes/dark.js"></script>

<!-- Chart code -->

<script>

fetch("/online/json_data.json").then(function(resp)
{
    return resp.json()
}).then(function(json_data){

    
    var chartData = []

    for (var Elem in json_data)
    {
        var time = json_data[Elem].time
        var players = json_data[Elem].players
        
        var date = new Date();
        date.setTime(time*1000)
        var temp_data = date

        var g_players = ""
        for (var i in players) {
            var row = players[i]
            g_players+=(row.name+"<br>")
        }
        

        chartData.push({
                date: temp_data,
                players_num: players.length,
                pidors: g_players,
        });

    }

    console.log(chartData)

    AmCharts.monthNames = [
        'Января',
        'Февраля',
        'Марта',
        'Апреля',
        'Мая',
        'Июня',
        'Июля',
        'Августа',
        'Хуйтября',
        'Октября',
        'Ноября',
        'Декабря'];

    var chart = AmCharts.makeChart("chartdiv", {
        "type": "serial",
        "theme": "dark",
        "hideCredits":true,
        "marginRight": 25,
        "autoMarginOffset": 5,
        "marginTop": 0,
        "dataDateFormat": "JJ:NN:SS",
        "dataProvider": chartData,
        "valueAxes": [{
            "axisAlpha": 0.3,
            "dashLength": 1,
            "minimum": 0,
            //"maximum": 15,
            "position": "left"
        }],
        "mouseWheelZoomEnabled": true,
        "graphs": [{
            "id": "g1",
            "balloonText": "<div style='margin:5px; font-size:12px;'><b>Total:[[players_num]]</b><br>[[pidors]]</div>",
            "bullet": "round",
            "bulletBorderAlpha": 0.1,
            "bulletColor": "#FFFFFF",
            "hideBulletsCount": 50,
            "title": "red line",
            "valueField": "players_num",
            "useLineColorForBulletBorder": true,
            "balloon":{
                "drop":false
            }
        }],
        "chartScrollbar": {
            "autoGridCount": true,
            "graph": "g1",
            "scrollbarHeight": 40
        },
        "chartCursor": {
           "limitToGraph":"g1",
           "categoryBalloonDateFormat": "JJ:NN:SS, DD MMMM",
        },
        "categoryField": "date",
        "categoryAxis": {
            "equalSpacing": false,
            "parseDates": true,
            "minPeriod": "ss",
            "axisColor": "#DADADA",
            "dashLength": 1,
            "minorGridEnabled": true
        },
        "export": {
            "enabled": false,
        }
    });

    chart.addListener("rendered", zoomChart);
    zoomChart();

    // this method is called when chart is first inited as we listen for "rendered" event
    function zoomChart() {
        // different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
        chart.zoomToIndexes(chartData.length - 40, chartData.length - 1);
    }


    // generate some random data, quite different range

    // generate some random data, quite different rang
})
</script>

<!-- HTML -->
<div id="chartdiv"></div>	